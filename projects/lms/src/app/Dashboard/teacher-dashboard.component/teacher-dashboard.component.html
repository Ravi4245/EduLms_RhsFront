<header class="top-navbar">
  <div class="navbar-content">
    <div class="navbar-center-text">
      <h1>Hi {{ profile.fullName }}, welcome to your dashboard</h1>
    </div>
    <button class="logout-btn" (click)="logout()">ğŸšª Logout</button>
  </div>
</header>

<div class="dashboard-container">
  <!-- Sidebar -->
  <nav class="sidebar">
    <h2>ğŸ“‹ Menu</h2>
    <ul>
      <li (click)="activeSection = 'profile'">ğŸ‘¤ Profile</li>
      <li (click)="activeSection = 'create-course'">ğŸ“˜ Create Course</li>
      <li (click)="activeSection = 'my-courses'">ğŸ“š My Courses</li>
      <li (click)="activeSection = 'enrolled-students'">ğŸ‘¨â€ğŸ“ Enrolled Students</li>
      <li (click)="activeSection = 'create-assignment'">ğŸ“ Create Assignment</li>
      <li (click)="activeSection = 'my-assignments'; loadCreatedAssignments()">ğŸ§¾ My Assignments</li>
     
      <li (click)="activeSection = 'assign-course'">ğŸ“š Assign Course</li>
      <li (click)="activeSection = 'assign-assignment'">ğŸ§¾ Assign Assignment</li>
      <!-- <li (click)="activeSection = 'assigned-students-by-course'">ğŸ‘¨â€ğŸ“ Assigned Students by Course</li>
      <li (click)="activeSection = 'assigned-students-by-assignment'">ğŸ“ Assigned Students by Assignment</li> -->
      <li (click)="activeSection = 'all-submissions'">ğŸ“ All Submissions</li>
       <li (click)="activeSection = 'performance-report'">ğŸ“ˆ Performance Report</li>
    </ul>
  </nav>

  <!-- Main Content -->
  <div class="content">
    <h1>ğŸ‘¨â€ğŸ« Teacher Dashboard</h1>

    <!-- Profile -->
    <section *ngIf="activeSection === 'profile'" class="card">
      <h2>ğŸ‘¤ Profile</h2>
      <p><strong>Full Name:</strong> {{ profile.fullName }}</p>
      <p><strong>Email:</strong> {{ profile.email }}</p>
      <p><strong>Experience:</strong> {{ profile.experience }} years</p>
      <p><strong>Specialization:</strong> {{ profile.specialization }}</p>
      <p><strong>Phone:</strong> {{ profile.phone }}</p>
    </section>

    <!-- Create Course -->
    <section *ngIf="activeSection === 'create-course'" class="card">
      <h2>ğŸ“˜ Create Course</h2>
      <input name="courseName" [(ngModel)]="newCourse.courseName" placeholder="Course Name" />
      <input name="description" [(ngModel)]="newCourse.description" placeholder="Description" />
      <input name="category" [(ngModel)]="newCourse.category" placeholder="Category" />
      <input type="file" (change)="onCoursePdfSelected($event)" accept=".pdf" />
      <button (click)="createCourse()">Create Course</button>
    </section>


    <!-- my course -->
<section *ngIf="activeSection === 'my-courses'" class="courses-section">
  <h2 class="section-title">ğŸ“š My Courses</h2>

  <div class="courses-list" *ngIf="courses.length > 0; else noCourses">
    <div *ngFor="let c of courses" class="course-card">
      <div class="course-info">
        <h3 class="course-name">{{ c.courseName }}</h3>
        <p class="course-category">{{ c.category }}</p>
        <p class="course-id"><strong>Course ID:</strong> {{ c.courseId }}</p>
      </div>
      <div class="course-actions">
        <button class="btn btn-danger" (click)="deleteCourse(c.courseId)">Delete</button>
        <button 
          *ngIf="c.pdfFilePath" 
          class="btn btn-secondary" 
          (click)="viewPdf(c.pdfFilePath)">
          ğŸ“„ View PDF
        </button>
      </div>
    </div>
  </div>

  <ng-template #noCourses>
    <p class="no-courses-msg">You have not created any courses yet.</p>
  </ng-template>
</section>


    <!-- Enrolled Students with Pagination -->
    <section *ngIf="activeSection === 'enrolled-students'" class="card">
      <h2>ğŸ‘¨â€ğŸ“ Approved Students</h2>
      <table>
        <thead>
          <tr>
            <th>Student Name</th>
            <th>Email</th>
            <th>Student ID</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of paginatedEnrolledStudents">
            <td>{{ student.studentName }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.studentId }}</td>
          </tr>
        </tbody>
      </table>
      <div class="pagination-controls">
        <button (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">â¬…ï¸ Prev</button>
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
        <button (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">Next â¡ï¸</button>
      </div>
    </section>

    <!-- Create Assignment -->
    <section *ngIf="activeSection === 'create-assignment'" class="card">
      <h2>ğŸ“ Create Assignment</h2>
      <input [(ngModel)]="newAssignment.courseId" placeholder="Course ID" type="number" />
      <input [(ngModel)]="newAssignment.title" placeholder="Title" />
      <input [(ngModel)]="newAssignment.description" placeholder="Description" />
      <input [(ngModel)]="newAssignment.dueDate" type="date" />
      <input type="file" (change)="onFileSelected($event)" accept=".pdf" />
      <button (click)="createAssignment()">Create Assignment</button>
    </section>

<section *ngIf="activeSection === 'my-assignments'" class="assignments-section">
  <h2 class="section-title">ğŸ§¾ My Created Assignments</h2>

  <div class="assignment-list" *ngIf="assignments.length > 0; else noAssignments">
    <div *ngFor="let a of assignments" class="assignment-card">
      <div class="assignment-info">
        <h3 class="assignment-title">{{ a.title }}</h3>
        <p><strong>ID:</strong> {{ a.assignmentId }}</p>
        <p><strong>Course ID:</strong> {{ a.courseId }}</p>
        <p><strong>Due Date:</strong> {{ a.dueDate | date: 'longDate' }}</p>
        <a 
          *ngIf="a.uploadFilePath" 
          class="btn btn-secondary" 
          [href]="'https://localhost:7072/' + a.uploadFilePath" 
          target="_blank">
          ğŸ“„ View PDF
        </a>
      </div>

      <div class="assignment-actions">
        <button class="btn btn-edit" (click)="startEditAssignment(a)">âœï¸ Edit</button>
        <button class="btn btn-danger" (click)="deleteAssignment(a.assignmentId)">ğŸ—‘ï¸ Delete</button>
      </div>
    </div>
  </div>

  <ng-template #noAssignments>
    <p class="no-assignments-msg">No assignments have been created yet.</p>
  </ng-template>

  <!-- Edit form -->
  <div *ngIf="editingAssignment" class="edit-form">
    <h3>Edit Assignment (ID: {{ editingAssignment.assignmentId }})</h3>
    <label>
      Title:
      <input [(ngModel)]="editingAssignment.title" />
    </label>
    <label>
      Due Date:
      <input type="date" [(ngModel)]="editingAssignment.dueDate" />
    </label>
    <label>
      Course ID:
      <input type="number" [(ngModel)]="editingAssignment.courseId" disabled />
    </label>
    <br />
    <button class="btn btn-save" (click)="updateAssignment()">ğŸ’¾ Save</button>
    <button class="btn btn-cancel" (click)="cancelEdit()">Cancel</button>
  </div>
</section>


    <!-- Performance Report -->
<section *ngIf="activeSection === 'performance-report'" class="card">
  <h2>ğŸ“ˆ Create Performance Report</h2>

  <!-- Student Dropdown -->
  <label for="student-select">ğŸ‘¨â€ğŸ“ Select Student:</label>
  <select [(ngModel)]="newPerformance.studentId" id="student-select">
    <option value="" disabled selected>Select a Student</option>
    <option *ngFor="let student of enrolledStudents" [value]="student.studentId">
      {{ student.studentName }} (ID: {{ student.studentId }})
    </option>
  </select>

  <!-- Course Dropdown -->
  <label for="course-select">ğŸ“˜ Select Course:</label>
  <select [(ngModel)]="newPerformance.courseId" id="course-select">
    <option value="" disabled selected>Select a Course</option>
    <option *ngFor="let course of courses" [value]="course.courseId">
      {{ course.courseName }} (ID: {{ course.courseId }})
    </option>
  </select>

  <!-- Grade and Remarks -->
  <input [(ngModel)]="newPerformance.averageGrade" type="number" placeholder="Marks" />
  <input [(ngModel)]="newPerformance.remarks" placeholder="Remarks" />
  <button (click)="createPerformance()">Create Report</button>

  <!-- Existing Reports -->
  <h3>ğŸ“Š Existing Reports</h3>
  <ul>
    <li *ngFor="let p of performanceReports">
      <div *ngIf="editingReportId !== p.performanceReportId">
        Student: {{ p.studentId }} | Course: {{ p.courseId }} | Grade: {{ p.averageGrade }} | Remarks: {{ p.remarks }}
        <button (click)="editReport(p)">âœï¸ Edit</button>
      </div>
      <div *ngIf="editingReportId === p.performanceReportId">
        Student: {{ p.studentId }} | Course: {{ p.courseId }}
        <input [(ngModel)]="p.averageGrade" type="number" placeholder="Grade" />
        <input [(ngModel)]="p.remarks" placeholder="Remarks" />
        <button (click)="updatePerformance(p)">âœ… Update</button>
        <button (click)="cancelEdit()">âŒ Cancel</button>
      </div>
    </li>
  </ul>
</section>





<section *ngIf="activeSection === 'assign-course'" class="card">
  <h2>ğŸ“š Assign Course</h2>

  <!-- Form -->
  <div style="margin-bottom: 1rem;">
    <!-- Student Dropdown -->
    <label for="studentSelect">ğŸ‘¨â€ğŸ“ Select Student:</label>
    <select id="studentSelect" [(ngModel)]="assignCourseData.studentId">
      <option value="" disabled selected>Select a student</option>
      <option *ngFor="let student of enrolledStudents" [value]="student.studentId">
        {{ student.studentName }} (ID: {{ student.studentId }})
      </option>
    </select>

    <!-- Course Dropdown -->
    <label for="courseSelect">ğŸ“˜ Select Course:</label>
    <select id="courseSelect" [(ngModel)]="assignCourseData.courseId">
      <option value="" disabled selected>Select a course</option>
      <option *ngFor="let c of courses" [value]="c.courseId">
        {{ c.courseName }} (ID: {{ c.courseId }})
      </option>
    </select>

    <button (click)="assignCourseToStudent()">Assign</button>
  </div>

  <!-- Enrolled Students Preview -->
  <div class="assign-preview">
    <h3>ğŸ‘¨â€ğŸ“ Enrolled Students</h3>
    <table>
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Email</th>
          <th>Student ID</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of enrolledStudents">
          <td>{{ student.studentName }}</td>
          <td>{{ student.email }}</td>
          <td>{{ student.studentId }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- My Courses Preview -->
  <div class="assign-preview">
    <h3>ğŸ“˜ Available Courses</h3>
    <table>
      <thead>
        <tr>
          <th>Course Name</th>
          <th>Category</th>
          <th>Course ID</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of courses">
          <td>{{ c.courseName }}</td>
          <td>{{ c.category }}</td>
          <td>{{ c.courseId }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>






<section *ngIf="activeSection === 'assign-assignment'" class="card">
  <h2>ğŸ§¾ Assign Assignment</h2>

  <!-- Assignment Form -->
  <!-- Student Dropdown -->
  <label for="studentSelect">ğŸ‘¨â€ğŸ“ Select Student:</label>
  <select id="studentSelect" [(ngModel)]="assignAssignmentData.studentId">
    <option value="" disabled selected>Select a student</option>
    <option *ngFor="let student of enrolledStudents" [value]="student.studentId">
      {{ student.studentName }} (ID: {{ student.studentId }})
    </option>
  </select>

  <!-- Assignment Dropdown -->
  <label for="assignmentSelect">ğŸ“ Select Assignment:</label>
  <select id="assignmentSelect" [(ngModel)]="assignAssignmentData.assignmentId">
    <option value="" disabled selected>Select an assignment</option>
    <option *ngFor="let a of assignments" [value]="a.assignmentId">
      {{ a.title }} (ID: {{ a.assignmentId }}, Course ID: {{ a.courseId }})
    </option>
  </select>

  <button (click)="assignAssignmentToStudenta()">Assign</button>

  <div class="assign-preview" style="margin-top: 2rem;">
    <!-- Enrolled Students Preview -->
    <h3>ğŸ‘¨â€ğŸ“ Enrolled Students</h3>
    <table>
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Email</th>
          <th>Student ID</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of enrolledStudents">
          <td>{{ student.studentName }}</td>
          <td>{{ student.email }}</td>
          <td>{{ student.studentId }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="assign-preview" style="margin-top: 2rem;">
    <!-- Assignments Preview -->
    <h3>ğŸ§¾ Available Assignments</h3>
    <table>
      <thead>
        <tr>
          <th>Assignment Title</th>
          <th>Course ID</th>
          <th>Assignment ID</th>
          <th>Due Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of assignments">
          <td>{{ a.title }}</td>
          <td>{{ a.courseId }}</td>
          <td>{{ a.assignmentId }}</td>
          <td>{{ a.dueDate | date }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>






    <!-- All Submissions -->
    <section *ngIf="activeSection === 'all-submissions'" class="card">
      <h2>ğŸ“ All Submissions</h2>
      <ul>
         <button (click)="loadSubmittedAssignments()">Refresh Submissions</button>
        <li *ngFor="let s of submissions">
         
          ğŸ“„ <strong>{{ s.assignmentTitle }}</strong> by {{ s.studentName }}
          <br />
          Grade: {{ s.grade }} 
          <a [href]="'https://localhost:7072/' + s.submittedFilePath" target="_blank">View File</a>
        </li>
      </ul>
    </section>


 








<!-- ğŸ”¹ Assigned Students by Course -->
<section *ngIf="activeSection === 'assigned-students-by-course'" class="card">
  <h2>ğŸ‘¨â€ğŸ“ Assigned Students by Course</h2>

  <!-- Buttons to load students for each course -->
  <div *ngFor="let course of courses" style="margin-bottom: 8px;">
    <button class="btn btn-primary" (click)="getAssignedStudentsByCourse(course.courseId)">
      Show Students for Course: {{ course.courseName }}
    </button>
  </div>

  <!-- Show students for selected course -->
  <table *ngIf="assignedStudentsByCourse.length > 0" class="table table-bordered">
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Name</th>
        <th>Email</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let student of assignedStudentsByCourse">
        <td>{{ student.StudentId }}</td>
        <td>{{ student.StudentName }}</td>
        <td>{{ student.Email }}</td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="assignedStudentsByCourse.length === 0">No students assigned to this course yet.</p>
</section>

<!-- ğŸ”¹ Assigned Students by Assignment -->
<section *ngIf="activeSection === 'assigned-students-by-assignment'" class="card" style="margin-top: 20px;">
  <h2>ğŸ“ Assigned Students by Assignment</h2>

  <!-- Buttons to load students for each assignment -->
  <div *ngFor="let assignment of assignments" style="margin-bottom: 8px;">
    <button class="btn btn-info" (click)="getAssignedStudentsByAssignment(assignment.assignmentId)">
      Show Students for Assignment: {{ assignment.title }}
    </button>
  </div>

  <!-- Show students for selected assignment -->
  <table *ngIf="assignedStudentsByAssignment.length > 0" class="table table-bordered">
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Name</th>
        <th>Email</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let student of assignedStudentsByAssignment">
        <td>{{ student.StudentId }}</td>
        <td>{{ student.StudentName }}</td>
        <td>{{ student.Email }}</td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="assignedStudentsByAssignment.length === 0">No students assigned to this assignment yet.</p>
</section>
